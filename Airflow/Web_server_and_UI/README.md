# Веб-сервер и UI

1. Чтобы запустить веб-сервер в консоли выполните команду `airflow webserver -p 8080` или в браузерной строке введите `http://localhost:8080/`
2. На предыдущем шаге был создан пользователь airflow с паролем airflow. Необходимо ввести эти данные, чтобы войти в систему
3. Сразу после входа в панель Airflow увидите перед собой список всех DAG, которые подгрузил Airflow для вас по умолчанию исключительно в ознакомительных целях:
* Pause/Unpause DAG — слева находится переключатель для включения/выключения DAG. По умолчанию все новые DAG будут остановлены. Чтобы запустить DAG его необходимо предварительно включить
* Колонка Owner обозначает владельца/автора DAG. Эта опция задаётся в коде
* Runs — показывает состояние запусков прошлых DAG. Есть 3 состояния:
  * Успешно выполнен
  * Выполняется
  * Есть ошибки при выполнении
* Schedule — показывает с какой периодичностью будет запускаться DAG. Если значение None, то запуска по расписанию не будет, но можно запускать и вручную
* Last Run — дата и время последнего запуска DAG
* Recent Tasks — отражает текущее состояние последних запусков DAG (по факту последний запуск DAG и его операторов)
* Actions — кнопки манипуляции с DAG. Можно запустить DAG вручную, обновить или удалить DAG
* Links — список для быстрого доступа к просмотру кода DAG, деталей выполнения, просмотру в виде графа или диаграммы Ганта, анализ времени выполнения задач и т.д.

## Просмотр DAG

Если кликнуть на любой DAG из списка, то можно увидеть по нему детальную информацию.
* Tree View — просмотр DAG и зависимостей между операторами в виде дерева, также справа находится статус выполнения всех операторов, входящих в DAG с легендой. На статусы можно кликать, чтобы посмотреть более детальную информацию.
* Graph View — фактически то же самое, что и Tree View, только в виде графа.
* Task Duration — график времени выполнения DAG и операторов
* Task Tries — показывает график повторных запусков операторов по периодам. Также в Airflow есть механизм повторных запусков в случае неудач
* Landing Times — график показывает время (в зависимости от периодичности, это могут быть дни, минуты и т.д. по оси Y) прошедшее относительно периода запуска и непосредственным запуском (DagRun) планировщиком. Представьте что есть DAG с schedule_interval=@daily запуск с execution_date=2020-01-01 должен быть запланирован на 2020-01-02T00:00:00, но планировщик из-за нагрузки запускает его в 2020-01-02T11:00:00, тогда Landing Time для него будет 11 часов или 0.46 дней
* Gantt — отображает историю выполнения DAG в виде Диаграммы Ганта. Очень удобно, когда в DAG входит множество операторов, которые могут выполняться параллельно.
* Details — детальная информация по DAG, включая названия операторов, автора, начальное время старта DAG и т.д.
* Code — просмотр кода DAG

## Панель администратора Airflow

* Variables — в этом разделе можно управлять переменными, которые будут храниться в базе данных Airflow. Удобно для хранения различной информации, например, адреса хостов удалённых сервисов. Нежелательно в этом разделе хранить данные доступов, т.к. переменные хранятся в открытом виде и могут быть скомпрометированы третьими лицами

* Configurations — раздел позволяет редактировать настройки Airflow, используя графический интерфейс. По умолчанию опция отключена из соображений безопасности

* Connections — раздел для хранения данных о доступе к различным сервисам: базам данных, облачным провайдерам, сторонним API сервисам и т.д. Не рекомендую в DAG коде хранить пароли и секретные ключи. Лучше использовать для этого раздел Connections. При использовании Connections в коде вам необходимо лишь будет передать значение conn_id

* Plugins — раздел для управления плагинами Airflow. По умолчанию плагины можно подгрузить, разместив код по пути AIRFLOW_HOME/plugins

* Pools — возможность задать пул или другими словами некое ограничение на количество параллельно выполняющихся задач. Представим, что вы хотите регулярно качать данные с внешнего сервиса. У сервиса есть ограничение на количество одновременных соединений — 2. В этом случае вы создаёте пул со значением 2 и присваиваете ему имя. Далее во всех операторах, отвечающих за скачивание данных, передаёте название этого пула

* XComs — это механизм обмена сообщениями между операторами. Т.к. задачи могут выполняться на разных компьютерах, то получить возвращаемое значение одного оператора и передать другому привычным способом не получится (например, путём цепочек вызовов или присвоением значения переменной). Для таких ситуаций и создан XCom (cross-communication). Механизм работает через базу данных. По сути это аналог key-value базы, один оператор записывает значение под определённым ключом, а другой оператор может получить это значением, используя этот ключ. Не рекомендуется таким способом передавать большие сообщения, т.к. это требует дополнительных накладных расходов. Также в этом разделе можно увидеть все существующие сообщения, созданные операторами.
